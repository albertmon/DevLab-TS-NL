package nl.devlab.flyingSaucer.replaceElementFactory;

import java.io.IOException;

import org.w3c.dom.Element;
import org.xhtmlrenderer.extend.FSImage;
import org.xhtmlrenderer.extend.ReplacedElement;
import org.xhtmlrenderer.extend.ReplacedElementFactory;
import org.xhtmlrenderer.extend.UserAgentCallback;
import org.xhtmlrenderer.layout.LayoutContext;
import org.xhtmlrenderer.pdf.ITextFSImage;
import org.xhtmlrenderer.pdf.ITextImageElement;
import org.xhtmlrenderer.render.BlockBox;
import org.xhtmlrenderer.simple.extend.FormSubmissionListener;

import com.lowagie.text.BadElementException;
import com.lowagie.text.Image;

// *** Usage ***

// <img style="width: 400px;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAArIAAADXCAYAAADm37JAAAAeNUlEQVR4nO2dzW9U193H+29UoCQoDSUvLW1SoefZjPAWCl00Eo4fPV0kfnkW7cIYJYtWlonSTYzpIiyMkaARxhQSCctDZjXSjJxFRrKxowiEbSLhLK6sNIwU3UliTU3O71nATOzxvPvee94+H+mzcPwSm7nn3u+c8zu/8zMBAAAAALCQn+n+BQAAAMA9Vosr6s7Gorp+b0ZdWr6oLi1fVGeyp9VQZqDqkcuvSTtu/54z2dPVn3f93oy6s7GoVosrSvffC3ogyAIAAEBXhOWwGlbPF86pocyA6plOtR1Qo7ZnOqWGMgPqfOFcNeSG5ZCQ6zAEWQAAAGiLOxuL1ZnVkzePawusnXry5nF1Jnu6Gm51/ztCdBBkAQAAoC53NharM626w2jUDmUG1KXliwRbyyHIAgAAgIiIBKVA3X6QVmeyp7WWCCRtz3RKncmeVrcfpFVQCgi2FkGQBQAA8JigFKjr92ZU32yvN8G1lX2zver6vRlCrQUQZAEAADwjLIeE1w5DLZvGzIQgCwAA4An5r3Lq7Pwo4bVLz86PqsWNBQKtQRBkAQAAHCYsh+rS8kWrugyY7smbx9Wl5YvM0hoAQRYAAMBBglLA7GsCnp0fpZZWIwRZAAAAh1jcWFBnsqcJsAl7JnuasgMNEGQBAAAcYHFjwcl+r7Y5lBkg0CYIQRYAAMBiCLBmSqBNBoIsAACAhQSlgBICCzyTPU0NbYwQZAEAACyi0oVAd0DDzqTLQTwQZAEAACzh9oO0V0fHumbPdErdfpAmzEYIQRYAAMBwVosr1ME65FBmQK0WVwi0EUCQBQAAMBjKCNz10vJFwuweIcgCAAAYyOLGAqdxeWDfbC/dDfYAQRYAAMAwmIX1T2Znu4MgCwAAYAhBKVB9s72EWE/tm+2lVVeHEGQBAAAMIL02R0cClJ7plEqvzRFm24QgCwAAoJGwHKqz86MEWNzh2flRwmwbEGQBAAA0QSkBNpNSg9YQZAEAADSwuLFAKQG2tGc6RVeDJhBkAQAAEia9NkeAxY6kbrY+BFkAAIAEoR4Wu5W62d0QZAEAABIgLIfqTPY0IRb35Nn5URWWQwLtUwiyAABP+X7re1XrNz98o7754Ztd//37re95kEDbhOWQTV0YmX2zvYTZpxBkAcALwnKo7mwsquv3ZtSl5YtqKDMQ6fGfJ28eV0OZAXVp+aK6fm9G3dlY5EEDIkKIxXgkzD6BIAsAzhGWQ5X/KqfOF86pocyA9gAxlBlQ5wvnVP6rHA8ez6C9FsYpYZYgCwCOcGdjUZ0vnLMiNPTN9qpLyxfVnY1Frx9ArrNaXKG9FsZuz3RKrRZXvL2XEGQBwErCcqhuP0g7sXnmTPa0uv0g7f3MiksQYjFJfQ6zBFkAsIr8Vzmnj/M8Oz+q8l/lvHwguUJQCgixmLg90ykvTwEjyAKA8awWV9T5wjmvwkHPdEqdL5zzdpbFVtjYhTr1sWaWIAsAxrK4sWDEZi3dDmUGOKLSAgixaIK+hVmCLAAYx+0HaQJsHYcyA+r2g7Q3DyibIMSiSfoUZgmyAGAMtx+kI+3t6qonbx4n0BqGC5sO0S19Oc6WIAsA2smv5wiwXXjy5nGVX2djmG5c3nyIdutDmCXIAoA2glJACUEEDmUGvNytbALptTmuXzTa9Nqc0/cGgqwlPFZbauvH+j5WW05fpOAeYTlUl5YvEgAi9tLyRe4FCbK4scA1jFbo8mZRgqwBrBZX1J2NRXVp+aI6Oz+qhjIDe2oz1DOdUkOZAXV2frR6ehAtfMAUFjcWKCOI0ZM3j9PhIAHoFYs26XKPWYJswmw/A17HDte+2V7OfActhOXQiVO4bPFM9jRjPCboUIA22jfb6+T9gCCbADqDazsXdiXY6v53AndZLa4wC6vBkzePsxoTA2zuQlt1cfMXQTYmVosr6uz8qFVLTz3TKXV2fpQHH0QKtbD6vX5vhjEdEWzuQtt1bfMXQTZCglKgrt+bcWLm6eTN4+r6vRlna2ogfsJySEcCg6TUYO9QF4su6Fq9LEE2Alw/RpPjMaFTFjcWeOAbKKUGe8PE8jDEbnSpXpYguwdcD7C1EmihHVh6NV/XlhaTYGppkusanXJqadKJ+wBBtgvyX+W8CrC1DmUG2BwGdbl+b8bbcWGbhNn2oV8suqoLk1ME2Q5YLa54HWBrHcoMsEwJVdjJbZ8u7mCOA0oK0FVdKDEgyLZBWA7V+cI5bmQNPF84xyYSzyHE2ithtjmUFKDr2l5iQJBtwe0HaTattGHPdErdfpC2ejBA59CZwA3paFCf1eIK1zZ6oc2rqwTZBgSlgAd0Fw5lBpxq6wGN4XQjt+yb7SXM1sAzAH1xKDNg7dgnyNYhv55jFnYP9kynVH6dzWCuw0PePc9kTzNun0L3DfRNWzeAEmRroBY2Os8Xzlk5KKA11MS6KzWzT1YbmMxA3+yZTlm5KkOQfUpQClgmjcG+2V5KDRyDEOu+vodZNnihr9q48YsgK5QSxC2lBu4wc/ca48QTbV1m3CtBKeAaR6+1bfLJ+yBLHVRy+vpgdAXGin/6OGbPZE9znaPX2lYr73WQ5cGcvD4+GF2Ak4381ea2PJ3CdY74RJtO/PI2yFLnp0/f6+9sg40vfnvy5nErN4B0A504EJ9oUzsuL4MsIVa/hFl74OGOti01dgOzsYg7tWVW1rsgS4g1R8Ks+bB7GyvO3L3m9HjlDRviTm2ZlfUqyBJizXOiMG7FQPERjufEWl2tl2U2FrG+NszKehNk2dhlrmwAM4+wHKqTN48zZnCHrtbLjmSHudYR6ziSHTZ+vHsRZAmx5kuYNQtaEGEjXauXpW8sYnNN7yvrfJDNr+e4SVmiDUsYPsAyK7bSpbE6RskZYlPHDN/P4nSQDUoBbYMssmc6xXG2mqGkANvx5M3jTozTsBxyrSO2ocklRU4H2b7ZXm5Sltk322vsYPEBuhRgu9p4JnstXO+I7WnyeHc2yE4UxrlBWSqdDPRArSB2qu0rKKw+ILanyaswTgZZ6mLtN7+eM3bQuAp9NLFTbekzWQ+eE4idaWptvHNBlrpYN6ReNll4qGO32vqmk01eiJ1p6qYv54Iss0ruaPNsj22wxIrdavKSYyPY5IXYnSZu+nIqyNIv1j1tne2xCcYN7lXb+kDP3L3GNY/YhSYeVe1MkA3LISUFDtoznXLyJCGTYDYW96pts7J0tEHsThM7CzkTZOlS4K50MYgPZmMxKm1ZPaE7B+LeNG3/ihNBdrW4wo3JcVeLK0YNHFegphyj0paadsoKEPemaeUFTgRZHsbua8tD0iY4ihaj1tT2PNuhrABxb5pWXmB9kKVtkD/a8JC0Cd4AYtSa/oaTsgLEaDSpvMD6IMvD2B9Nf0jaBOU4GJcmlwFRE44YjSZ1KrE6yLI06p/MykYDmyMxLk3enDmSHea6R4zAkeywMePc6iDLbKx/MisbDbSqw7g0uRUX1z1iNPZMp4wZ59YGWWZj/ZVZ2b1BXTnGrYmtuHhmIEarKc9ia4Mss7H+yqzs3uCMeYxbE89kp5wGMVqnliaNGOdWBll2nqJJOyZtgjPmMSlNO5FvMNPPtY8YoYOZfiPGuJVBdmppkhuS55rWkNkW2LWNSWnSrmYR0f7vgeiiJmBlkOVseDR5Q4nJsGsbk9KkXc3UxyLGowl1stYFWfpfYkWT+1Waiu7XDP3SFFjFQ4xHE1ZHrQuybFTBiib3qzQRZqUwaU2YrRFhJQIxLk1YebEuyNIHECua1MfOBti1jUlryq5mytEQ49GEMj+rgiz9L7FWU2Z8bKBvtpfxg4lqwq5mOnUgxqvuDiVWBVlmlLBWU2Z8TIeHOepS90OOkhrEeNU9oWRVkGVGCWvtm+0lyLYBqxmoS92nfM3cvca1jxijujd8WRNkmVHCRuqe8bEBVjNQl7o3ZbJBGDFedY9xa4IsM0rYSN0zPjbAqUaoS911slz7iPGqe4xbE2SZUcJG6n43aAO6XyP0W53Q6QYxXnV3LrAmyFIfi42kTrY5lOWgbnWW/+j+2xF9UCfWBFndLxKaLTSGXduoW127mjkJEjEZdZ60aUWQ5WaEreS42sawaxt1m16b0zI+eROHmIw6W3BZEWS5GWErdfexMxnOmUfd6ur3zJs4xGTU2YLLiiDLgxhbycEIjWHXNupW165mnh2IyajzGWxFkKUPILZybH6UINsAzplH3erakEmQRUxGgmwLmFHCVuruY2cyul8bxCOX9WzIHMkO8+xATMCR7DBBthn0AcRW9kynCLIN0P3aIB65rCfIMgmCmIw6J5OsCLK6XyC0Q6iP7tcF8chlgiyiyxJkW6D7BUI7hN1895/veJCjEW5ubSb+oOMgHcRkJMi2QPcLhHYIuyHIoil+95/vEn/Q6f6bEX1RZ3mf8UH2sdry5kH88f2PpBB8JoXgM8l8+Ym89+m72n8nm3ystqiTrcHXIMtYMk+CrPt++MWVXer+nTA5dWF8kN360Z8gKyJSflyWz79elrAciohI5stPtP9etrj1I0G2Fl+DrAhjyTQJsu5bGXdBKajKm0h/1AVB1iBFRIJSUP24/Lgs5cflrn9e5stP5OG3D7X/XUlJkN2Nz0E2yrEUlb6Nye0SZN23dtx1os9jwxV1QZA1SJGdN4GgFIiIyIWFD+TI5SfLpQ+/fShBKZD8em7H9358/6PqO+APv7gimS8/ERGRsBxKIfhs19e7KEF2N//+/t/ejJ92x9J7n75bHSeF4LMds0Yrj+5LUApk5dH96n+rHVuVn1n7te99+q48/PahfHz/I8l8+Un1c5Wv93FMbre4WSTIOm7tuKv43qfvysqj+ztWRT7/elk+/3pZjlyuPzZafU+n4xiTef11QJA1SJGdN4GwHFZnkTJfflId5JWHcmWAf/jFFRERya/nJL+ekwsLH8jH9z8SkZ9uDB/f/0j73xe3BNndEGR3j6Xtny/+8EiKPzySI5dfk+IPj2Tl0X358Isr1f9eb2w1+trKz62UNDz89qGISDXM+jgmt0uQdd/KuGr0ue0zrtu/ttHYaPY92z9uNY51/7v4oi4IsgYpItXZ1spDsFFdn4hIIfhMjlx+TQrBZyIiu2Z4Kj9P99+VlATZ3fheWtBoLIk8eWhWPq7MCFVmXCtjqt7YavS19cZcq499ktIC962l3pvHdj9u93vaGce6/118URcEWYMUeTJIKzuuK7M/FT/84kp1yUTkpyD73qfvSvlxWUREij88qn5f5efp/ruSkiC7G9+DbKOxVPl85ePKA2/7JpXKsmTt2Gr0tfV+bquPfZIg677Nru9uxkan39NsbGIyr78OjA+yPrXfEml8E6gsvVRmhkR+CrIVtw/iVj/PRX9UPxJka/A9yLb7+crYadQuaPvYava1tT+31cc+SZB132bXdzdjo9PvaTWOMf7XXwfGB1kRf25GIo1vApXl0QsLH8iFhQ9ERKpF75UNLEcuP6kP2h5kty+7uC7shiDb3ucrtbDbVzQqY612bDX62no/t97HPo3J7RJk3bf2eq/9XFgO5b1P362OoVZjo53vaWcc6/538cGjVzkQoSm6X6CkFGl8E6gMUJEnxe+V5c4LCx9Ifj1X/Vz5cbk6cD//ern6331YXoHdEGTb//z28SLy0wavCo3GVuVr6/3cyvfV+3/4MCa3q+WI2lunvLz+dVl7/W93+7Vf6b4jItU3ivXGRqvvqff/azQ2MV45orYFul8gk9z+7nJ7W5HKO9Z6X+9L+xGoj+7XxTZrx1GjsVXva9vRpzG5XR0MZvoJsgZZaVNX+bh2trTe2Gj1PY2kvCBZCbItOHo1xc0Im6pzWcN0dL82iEcuE2QRXZYg2wJuRthKnYPIdHS/NohHLusJsiPZYZ4diAk4kh0myDZjbH6UmxE2dWx+lCDbgBM3jjF+UKt9t05pGZ9TS5Nc+4gJOLU0SZBtBjcjbKXOQWQ6rGjY7a/+/rI888Z+2f/6Pnnpb4e0/z7dqGvFhGcHYjISZFuwuLHAzQiburixQJBtAA9zu33mjf2y7w8/r3rgrefk1QuHtf9enajrITdz9xrXPmICzty9RpBtxmpxhZsRNnW1uEKQbQAPc7t9pndnkN33h5/L/tf3yfP/d0Be+tsh+c0/fq39d2xlem1Oy/hkEgQxGXVOJlkRZEXYsILNhcbwMLfbl8delP1/3LcrzNYGW5PLDnQ95JgEQUzGoBQQZFtBY2tspK6NJLYQlkPGjuW+euGwHHjz2aZh1uSyg7Acahujuv92RB/UiTVBdqIwzsMY6zpRGCfItkD3a4TR+NJff9nW7OwvT//CqECrE/qQI8briRvHtD6DrQmy+fUcNyOsa349R5BtAZ0L3PI3//i1vPTXX8rzQweaBtsDbz0nr4y9qPV31d3jmWsfMV51j3FrgizLo9hIncuWtsCKhru2U3aw//V98sJfnpdXxl6U3138baK/n+4VE/qQI8ar7jFuTZAVoU4Wd0t9bHuwouG+7ZQdVHzuT8/IoXcOJtLxQPeKCV07EONVZ+stEcuCLLNKWCsHIbQHKxr++PLYi21tDNs+W3vgrefk0DsH5Vd/fzny2lrdKyZ07UCMV9193K0KsswqYa26B5BNsKLhl69eOCwHh3/R9ixtHOFWd+2cCG/iEONW95tVq4KsCDtQ8SePXk1pf0jaBCsa/vqbf/xaDr19UJ7732c6DrXbfeaN/XLgrefkwFvPyQt/eV4OvXNQDr1zUF4Ze1EOv/+KHH7/lR2h15QVkxM3jjl97R9+/5XqCXD7X98nh99/RfvvhH6ou2OBiIVBlsJ9rKi7wNw2WGLFI5dfk99d/K28PPaivPDn57uare3EwZEBNTY2Jp34z3/+s+q//vUvyefzVT///HNZX1+vurm52da1P5Iddvrarz3GeP/r+7T/TuiHI9lh7c9h64IsJ7VgRY6l7Rzdrxma56sXDsuv/v6yHHr7oBx489lIw22nITYuTwz9XsUZ2E1U93WFfqh7o5eIhUFWxP1lImytCcsZNuL6zBRGYxTh9r//9F8dz8bG5eDIgFdBdv8fmZHFZDRhn4qVQZZ2KmjCu0AbSa/NMXawa1+9cLhaC/vy2Ity6O2Dcujtg/LCn5+XA28+KwfefFae6X2yzP3GX94wJsiOjY1pD5dJhlhqZDEpTcDKIBuUAh7GnhuUAoJsF7CDG5Oym53Mm5ub8vDhw6rLy8uSy+WqXr9+Xa5cuVK1kyD72v+86vSs7P4/7pNDbx9M/MAL9FcTupKIWBpkRTh20GdNGTy2woZJjNux+VHjxujU0iTXPWKEmtKVxNogyw5sfzWhJsdm6MeMcav7NK968MxAjFZTnsXWBlkRZmV9lNnYaKAfM8alyRsxue4Ro9GkPu5WB1neYfunKe8AbYfDETAuTe7vTNcOxGg0oX9sBauDrAizsj7JbGx00I8Z49Lk/s507UCMxvTanDHj3PogS72fPzIbGy28CcSoNf3NJh1vEKPRpM5B1gdZER7IPmj6A9JGKM3BqLXhzWbfrVNc94h7sO/WKaPGuRNBlmVS9zV5udJmeBOIUWnLm00O1EHcm6YdSOREkBVh84rLmrx5xHaoGcSoNLHlVj0oL0DcmyaVFYg4FGTDcqhoreKeR6+mVDcnBEH7nLhxjHGDe9Lkllv1oLwAsTtNKysQcSjIijC75KK2zPLYDOMG96pJO5jbgfICxO40raxAxLEgK0LNn0vaUnPnAszKYrfaNhsr8mQFT/e/G6KNmrhC6lyQZSe2O9qwA9oVaGOH3WrrqsnY/CjXPGIHjs2PGjnWnQuyIiJTS5PcoCx3amnSyAHjMqxmYKfavGrCmzfEzjR1csnJICvCQ9lmbX442gy7ubFTTdu93CmU1CC2p8klRM4GWboY2CldCvTCaga2qwurJlzviO1p8nh3NsiKUC9ro6YuXfhCWA4Vs1TYSpNnZzqBTV+I7WnyBJPTQVaE1kI2aeumEdfgDSC20qU3nGz6QmyuqZu8KjgfZEUIszZoWx9K1xnJDjNmsK4j2WGnxiq14YjNNb0W3osgK0KYNVlCrHlQYoD1PHHjmJM17LxxQ6yvDW9cvQmyIiwhmehEYdz4QeIrq8UVxgvucLW44uR4pZwGsb42lBF5FWRFCLMmaXrdDXCUJ/6kiUdTRgktGxF3aksrTO+CrAhh1gQJsfbAsivasLy4V5iVRdypDbOxIp4GWRHCrE4pJ7ALejL7rat1sfVgVhbxibbMxop4HGRF2ACmQzZ22QmzVf7qal1sPbjOEZ9oy2ysiOdBVoQwm6SEWLthrPinj2OWUhr0XdtKibwPsiIi+fUcS6cxevRqStn07g4aw+Yvf/QxxIrQVxbR9L6xtRBknxKUAtV36xQ3sIjtu3VK2TYooDnUl7uv75sxp5YmucbRS6eWJq0b+wTZGiYK49zAIpJNXe5CmHVX30OsCBsc0U+PXk1ZubGTIFsHSg32Phjy6znrBgN0Bju83dO22rg4oSYcfdPWciKCbAOCUqB4UHfuYKafUgJPCMsh5TgO2XfrlJWzMXHCMwB90aZ2W7UQZFuQXptjdrYNmYX1k7Ac8obPAUeyw4TYOnBMM/qizRNQBNk2CMuhona2sROFcR6CnkPNrL1SE9scNn6h69q4wWs7BNkOWC2uMPu0zcFMv/KpWTo0hzBrn4TY9qCEBl2179Yp6+8BBNkuWNxY8DrQDmb66QsLdaHPrD3aurFDB5z4ha7qwmQUQXYP+BZoCbDQDuz2Nl9CbOdQYoCuaXtJQQWCbAS4HmgJsNApq8UVdeLGMWfHhK2euHGMcqA9QIkBuqILJQUVCLIREZZDlV6bUy6d0z2SHVbptTk2ckFXhOXQqfFgu3Qm2DtBKaCLDVrv0aspp9pkEmRjICgFaubuNSt7bPbdOqVm7l5z6iIHvVA3q9+Zu9cYzxFB6QzarmulRQTZmFktrqjFjQU1URg3Mtj23TqlJgrjanFjgSVHiA1KDfRIKUE80KEDbdXFTiUE2YQJy6HKr+e0BdtKcM2v51hmhESh1CBZKSWIFxMnJhCb6VJd7HYIsgZQmbWdWppUY/OjajDTv6c6rKNXU2ow06/G5kfV1NIks61gFIsbC8zOxuiJG8fYnJkA1MuiTbpWF7sdgqwlPFZbauvH+j5WW05enOA2tDOKXlfa6dgC/WXRFl1+c0uQBQBtBKXA6dZ1STmY6Xd2tsV02PyFpuva5q5aCLIAoJ38eo5ygy48ceOYyq/nnH5I2QCbv9BUXdzcVQtBFgCMIb02R6BtwxM3jinXZ1lsgzCLpulDiBUhyAKAgeTXc5Qc1HEw088MrKGE5dDIFovop323TnnTtYQgCwDG4vrxz+3KMdF2QJhFE/QpxIoQZAHAAlaLK2qiMO5Vu6MTN46picI4rfMsgzCLOvUtxIoQZAHAMvLrOeVyPeLY/CjlA5ZDj1nU4dGrKe9CrAhBFgAsJSyHKr0258RpYSPZYZVem/PyIeQqq8UVwiwm5tGrKW9XbwiyAOAEldPxbFjWHcz0V0/d0/3vBvGxWlyhCwfGbt+tU96GWBGCLAA4SFgOVX49pyYK40ZsFhvM9KuJwrjKr+eYdfUMamYxTn2sia2FIAsAXhCWQ7W4saBm7l5TU0uTajDTH2nA6Lt1SlVmWtNrc2pxY8H7Bww8gTCLcUiIfQJBFgDgKZtbm+q7/3y3w+JmURU3i7v+++bWpvcPEGifsBwasTqAbjiSHSbEPoUgCwAAkBAud9zAZPTlxK52IcgCAAAkCGEWu5UQuxuCLAAAQMKk1+YIs9iR6bU5QmwdCLIAAAAaoD0XtuOJG8e8bq/VCoIsAACAJtgEhs0czPSzqasFBFkAAADNTBTGCbO4w4nCOAG2DQiyAAAABpBfz3GsLcrRqymVX88RYtuEIAsAAGAIQSmg1MBjBzP9KigFhNgOIMgCAAAYxszda8zOeuTRqyk1c/caAbYLCLIAAAAGwuysHzILuzcIsgAAAAbD7KybMgsbDQRZAAAAw2F21i2ZhY0OgiwAAIAlpNfmOETBYk/cOKY4oStaCLIAAAAWEZZDNbU0SbmBRR69mlJTS5McbhADBFkAAAALCcuhGpsfJcwa7tj8KAE2RgiyAAAAFkP9rJmOZIepg00AgiwAAIADLG4sEGgNcDDTrxY3FgiwCUGQBQAAcIigFFByoMGx+VFmYDVAkAUAAHCQoBSwKSxmK5u4CLD6IMgCAAA4TFgO1czda7TtitBKGy02cemHIAsAAOAJ+fWcGpsfZZa2C49eTamx+VGVX88RXg2CIAsAAOAh6bU5NZIdJtC2cCQ7zCEGBvP/bgCwX4FANhoAAAAASUVORK5CYII=">

public class Base64ImageReplacedElementFactory implements ReplacedElementFactory {

	private final ReplacedElementFactory superFactory;
	
	public Base64ImageReplacedElementFactory(ReplacedElementFactory superFactory) {
		this.superFactory = superFactory;
	}

	@Override
	 public ReplacedElement createReplacedElement(LayoutContext c, BlockBox box, UserAgentCallback uac, int cssWidth, int cssHeight) {
	     Element e = box.getElement();
	     if (e == null) {
	         return null;
	     }
	     String nodeName = e.getNodeName();
	     if (nodeName.equals("img")) {
	         String attribute = e.getAttribute("src");
	         FSImage fsImage;
	         try {
	             fsImage = buildImage(attribute, uac);
	         } catch (BadElementException e1) {
	             fsImage = null;
	         } catch (IOException e1) {
	             fsImage = null;
	         }
	         if (fsImage != null) {
	             if (cssWidth != -1 || cssHeight != -1) {
	                 fsImage.scale(cssWidth, cssHeight);
	             }
	             return new ITextImageElement(fsImage);
	         }
	     }
	     return null;
	 }
	
	 protected FSImage buildImage(String srcAttr, UserAgentCallback uac) throws IOException, BadElementException {
	      FSImage fsImage;
	      if (srcAttr.startsWith("data:image/")) {
	         String b64encoded = srcAttr.substring(srcAttr.indexOf("base64,") + "base64,".length(), srcAttr.length());
	         @SuppressWarnings("restriction")
			byte[] decodedBytes = new sun.misc.BASE64Decoder().decodeBuffer(b64encoded);
	         fsImage = new ITextFSImage(Image.getInstance(decodedBytes));
	      } else {
	         fsImage = uac.getImageResource(srcAttr).getImage();
	      }
	      return fsImage;
	 }
	
	@Override
	public void reset() {
		this.superFactory.reset();
	}

	@Override
	public void remove(Element e) {
		this.superFactory.remove(e);
	}
	
	@Override
	public void setFormSubmissionListener(FormSubmissionListener listener) {
		this.superFactory.setFormSubmissionListener(listener);
	}

}
